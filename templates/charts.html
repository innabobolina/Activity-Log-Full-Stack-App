{% extends 'base.html' %}

{% block title %}Charts{% endblock %}

{% block content %}

  <h2>Charts</h2>

  <p style="color:magenta; font-size:150%;">Hello, {{ user.username }}!</p>

  <h2>Chart of {{ act.act_name }} in {{ act.act_unit }}</h2>

  <button class="graph-buttons" id="allTime">View All</button>
  <button class="graph-buttons" id="byWeek">By Week</button>
  <button class="graph-buttons" id="byMonth">By Month</button>

  <div id=canvas-container>
    <canvas id="myChart" width="300" height="200"></canvas>
  </div>  

  <script src="http://code.jquery.com/jquery.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
  <script type="text/javascript">

  // $('#byMonth').on('click', () => {
  //   alert('by month!');
  // });

  $('.graph-buttons').on('click', (e) => { 
    console.log("Clicked on");
        console.log(e.target);
                console.log(e.target.id);

      let allTimeLabels = [ {% for item in xx %}
                      "{{ item }}",
                      {% endfor %}
      ]

      let allTimeData = [ 
                {% for item in yy %}
                   "{{ item }}",
                  {% endfor %}
      ]

      let weekLabels = [ {% for item in xx7 %}
                      "{{ item }}",
                      {% endfor %}
      ]

      let weekData = [ 
                {% for item in yy7 %}
                   "{{ item }}",
                  {% endfor %}
      ]

      let monthLabels = [ {% for item in xx30 %}
                      "{{ item }}",
                      {% endfor %}
      ]

      let monthData = [ 
                {% for item in yy30 %}
                   "{{ item }}",
                  {% endfor %}
      ]


      // which bitton got clicked on  
      let button_id = e.target.id;
      let graphX;
      let graphY;

      if (button_id == "allTime") {
        console.log(button_id);
        graphX = allTimeLabels;
        graphY = allTimeData;
      }
      else if (button_id == "byWeek") {
        graphX = weekLabels;
        graphY = weekData;
      }
      else  {
        graphX = monthLabels;
        graphY = monthData;
      }


      // let x = ?
      // let y = ? 



    $('#canvas-container').empty();
    $('#canvas-container').append('<canvas id="myChart" width="300" height="200"></canvas>');

    const ctx = document.getElementById('myChart').getContext('2d');
    console.log('graphX',graphX);
    const chart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: graphX,
            datasets: [{
                label: 'Chart.js test',
                backgroundColor: 'rgb(255, 99, 132)',
                borderColor: 'rgb(255, 99, 132)',
                data: graphY
            }]
        },
        options: {}
    });
  });


</script>

{% endblock %}