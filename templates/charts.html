{% extends 'base.html' %}

{% block title %}Charts{% endblock %}

{% block content %}

  <h2>Charts</h2>

  <p style="color:magenta; font-size:150%;">Hello, {{ user.username }}!</p>

  <h2>Chart of {{ act.act_name }} in {{ act.act_unit }}</h2>

  <button class="graph-buttons" id="allTime">View All</button>
  <button class="graph-buttons" id="byWeek">By Week</button>
  <button class="graph-buttons" id="byMonth">By Month</button>

  <div id=canvas-container>
    <canvas id="myChart" width="300" height="200"></canvas>
  </div>  

  <script src="http://code.jquery.com/jquery.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
  <script type="text/javascript">


  // $('#byMonth').on('click', () => {
  //   alert('by month!');
  // });


  let allTimeLabels = [ {% for item in x %}
                  "{{ item }}",
                  {% endfor %}
  ]

  let allTimeData = [ 
            {% for item in y %}
               "{{ item }}",
              {% endfor %}
  ]

  let weekLabels = [ {% for item in x7 %}
                  "{{ item }}",
                  {% endfor %}
  ]

  let weekData = [ 
            {% for item in y7 %}
               "{{ item }}",
              {% endfor %}
  ]

  let monthLabels = [ {% for item in x30 %}
                  "{{ item }}",
                  {% endfor %}
  ]

  let monthData = [ 
            {% for item in y30 %}
               "{{ item }}",
              {% endfor %}
  ]

  // ------------------------------------------
  // a function to draw a chart
  // ------------------------------------------
  const activityChart = (graphX, graphY) => {

    $('#canvas-container').empty();
    $('#canvas-container').append('<canvas id="myChart" width="300" height="200"></canvas>');

    const ctx = document.getElementById('myChart').getContext('2d');
    console.log('graphX',graphX);
    const chart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: graphX,
            datasets: [{
                label: 'Activity',
                backgroundColor: 'rgb(255, 99, 132)',
                borderColor: 'rgb(255, 99, 132)',
                data: graphY
            }]
        },
        options: {}
    });
  }

  // ------------------------------------------
  // show allTime chart by default
  // ------------------------------------------
  let graphX = allTimeLabels;
  let graphY = allTimeData;
  activityChart(graphX, graphY);

  // ------------------------------------------
  // abc ...
  // ------------------------------------------
  $('.graph-buttons').on('click', (event) => { 
    console.log("Clicked on");
        console.log(event.target);
                console.log(event.target.id);

      // which bitton got clicked on  
      let button_id = event.target.id;

      let graphX;
      let graphY;

      if (button_id == "allTime") {
        console.log(button_id);
        graphX = allTimeLabels;
        graphY = allTimeData;
      }
      else if (button_id == "byWeek") {
        graphX = weekLabels;
        graphY = weekData;
      }
      else  {
        graphX = monthLabels;
        graphY = monthData;
      } 

    activityChart(graphX, graphY);

  });

  </script>


{% endblock %}